<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Udupi Division Guest House, Central GST</title>

<style>
body{font-family:Arial;background:#eef1f5;margin:0;padding:10px}
.container{max-width:1100px;margin:auto}
h1,h2,h3{text-align:center}
.card{background:#fff;padding:15px;border-radius:8px;margin-bottom:15px}
input,select,button{width:100%;padding:8px;margin-top:6px}
button{background:#007bff;color:#fff;border:none;cursor:pointer}
button:hover{background:#0056b3}
.hidden{display:none}
.logout{position:fixed;top:15px;right:15px;width:40px;height:40px;border-radius:50%}
table{width:100%;border-collapse:collapse;font-size:14px}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:#f0f0f0}
</style>
</head>

<body>

<button class="logout hidden" id="logoutBtn" onclick="logout()">⎋</button>

<div class="container">
<h1>Udupi Division Guest House, Central GST</h1>

<!-- LOGIN -->
<div class="card" id="loginCard">
<h2>Login</h2>
<button onclick="guestLogin()">Guest Login</button><br><br>
<button onclick="showCaretaker()">Caretaker Login</button>

<div id="caretakerFields" class="hidden">
<hr>
<input id="user" placeholder="Username">
<input id="pass" type="password" placeholder="Password">
<button onclick="caretakerLogin()">Login</button>
</div>
</div>

<!-- APP -->
<div id="app" class="hidden">

<!-- BOOKING FORM -->
<div class="card">
<h2>Add Booking</h2>
<form id="bookingForm">

<input id="guest" placeholder="Guest Name" required>
<input id="mobile" placeholder="Mobile Number" required>

<select id="roomType" required>
<option value="">Room Type</option>
<option value="Normal">Normal</option>
<option value="Suite">Suite</option>
</select>

<select id="roomCount" required>
<option value="">No of Rooms</option>
<option>1</option>
<option>2</option>
<option>3</option>
</select>

<input type="date" id="checkin" required>
<input type="date" id="checkout" required>

<div id="availability"></div>

<button type="submit">Add Booking</button>
</form>
</div>

<!-- CARETAKER REGISTER -->
<div class="card hidden" id="caretakerView">
<h2>Booking Register</h2>
<table>
<thead>
<tr>
<th>Guest</th><th>Mobile</th><th>Rooms</th>
<th>Type</th><th>Check-in</th><th>Check-out</th><th>Action</th>
</tr>
</thead>
<tbody id="register"></tbody>
</table>
</div>

</div>

<script>
const NORMAL_ROOMS = ["N1","N2","N3","N4"];
const SUITE_ROOMS = ["S1"];

let bookings = JSON.parse(localStorage.getItem("bookings")) || [];
let isCaretaker = false;

function showCaretaker(){
  caretakerFields.classList.remove("hidden");
}

function guestLogin(){
  isCaretaker=false;
  loginCard.classList.add("hidden");
  app.classList.remove("hidden");
  caretakerView.classList.add("hidden");
  logoutBtn.classList.remove("hidden");
  updateAvailability();
}

function caretakerLogin(){
  if(user.value==="udupi" && pass.value==="12345"){
    isCaretaker=true;
    loginCard.classList.add("hidden");
    app.classList.remove("hidden");
    caretakerView.classList.remove("hidden");
    logoutBtn.classList.remove("hidden");
    renderRegister();
  } else alert("Invalid credentials");
}

function logout(){
  app.classList.add("hidden");
  loginCard.classList.remove("hidden");
  caretakerFields.classList.add("hidden");
  caretakerView.classList.add("hidden");
  logoutBtn.classList.add("hidden");
}

function overlaps(a,b,c,d){
  return !(d<=a || c>=b);
}

function availableRooms(type, ci, co){
  const pool = type==="Suite" ? [...SUITE_ROOMS] : [...NORMAL_ROOMS];
  bookings.forEach(b=>{
    if(b.type===type && overlaps(ci,co,b.checkin,b.checkout)){
      b.rooms.forEach(r=>{
        const i = pool.indexOf(r);
        if(i>-1) pool.splice(i,1);
      });
    }
  });
  return pool;
}

function updateAvailability(){
  if(!roomType.value || !checkin.value || !checkout.value || checkin.value>=checkout.value){
    availability.innerHTML="";
    return;
  }
  const free = availableRooms(roomType.value, checkin.value, checkout.value);
  availability.innerHTML = free.length
    ? `Available rooms: <b>${free.length}</b>`
    : `<span style="color:red">No rooms available</span>`;
}

["roomType","checkin","checkout"].forEach(id=>{
  document.getElementById(id).addEventListener("change",updateAvailability);
});

bookingForm.onsubmit = e =>{
  e.preventDefault();
  if(checkin.value>=checkout.value) return alert("Invalid dates");

  const free = availableRooms(roomType.value, checkin.value, checkout.value);
  if(free.length < Number(roomCount.value)){
    alert("Rooms not available for selected dates");
    return;
  }

  const assigned = free.slice(0, Number(roomCount.value));

  bookings.push({
    guest:guest.value,
    mobile:mobile.value,
    type:roomType.value,
    rooms:assigned,
    checkin:checkin.value,
    checkout:checkout.value
  });

  localStorage.setItem("bookings",JSON.stringify(bookings));

  alert("✅ Booking confirmed\nRooms: " + assigned.join(", "));
  bookingForm.reset();
  availability.innerHTML="";
  renderRegister();
};

function renderRegister(){
  register.innerHTML="";
  bookings.forEach((b,i)=>{
    register.innerHTML += `
    <tr>
      <td>${b.guest}</td>
      <td>${b.mobile}</td>
      <td>${b.rooms.join(",")}</td>
      <td>${b.type}</td>
      <td>${b.checkin}</td>
      <td>${b.checkout}</td>
      <td>${isCaretaker ? `<button onclick="cancel(${i})">Cancel</button>` : ""}</td>
    </tr>`;
  });
}

function cancel(i){
  if(confirm("Cancel booking?")){
    bookings.splice(i,1);
    localStorage.setItem("bookings",JSON.stringify(bookings));
    renderRegister();
    updateAvailability();
  }
}

renderRegister();
</script>

</body>
</html>
